version: '3.8'

services:
  webapp-wrapper:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: webapp-wrapper-dev
    volumes:
      # Mount the current directory to /app in container
      - .:/app
      # Mount node_modules as named volume for better performance
      - node_modules:/app/node_modules
      # Mount build outputs
      - ./build:/app/build
      - ./uploads:/app/uploads
      - ./logs:/app/logs
    ports:
      # Expo development server
      - "3000:3000"
      - "8081:8081"
      # Expo development tools
      - "19000:19000"
      - "19001:19001" 
      - "19002:19002"
    environment:
      # Expo environment variables
      - EXPO_DEVTOOLS_LISTEN_ADDRESS=0.0.0.0
      - REACT_NATIVE_PACKAGER_HOSTNAME=0.0.0.0
      # Allow Expo to work in container
      - EXPO_TUNNEL=true
    working_dir: /app
    tty: true
    stdin_open: true
    # Keep container running
    command: tail -f /dev/null

  # Optional: Web server for testing built apps
  web-server:
    image: nginx:alpine
    container_name: webapp-wrapper-server
    ports:
      - "8080:80"
    volumes:
      - ./build:/usr/share/nginx/html:ro
    depends_on:
      - webapp-wrapper

volumes:
  node_modules: